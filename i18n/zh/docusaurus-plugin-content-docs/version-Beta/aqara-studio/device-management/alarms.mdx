# 配置功能点告警

在智能家居系统的设备管理中，针对每个功能点，Aqara Studio 支持您灵活配置和自定义告警规则，以实现对异常状态的实时监控和及时响应。本文将介绍如何为不同类型的数据点设置多样化的告警类别、触发条件及告警文案，助您更高效地保障设备安全与系统稳定。

## 告警配置流程

1. 进入 **设备管理** 页面，在左侧设备树找到你想要查看的功能点文件夹。
2. 双击该功能点文件夹，切换至该功能点的 **概览** 选项卡。
3. 找到 **告警配置** 区域，单击 **+** 按钮。
4. 在弹窗中配置如下参数：

    | 参数         | 说明                                                         |
    |------------|------------------------------------------------------------|
    | 源名称      | 告警的自定义名称。                                           |
    | 告警值      | 功能点达到该值时触发告警。当为布尔型功能点时，此参数为单选；当为枚举型功能点时，可多选。                                     |
    | 告警类型    | 告警级别，可选 Normal、Urgent、Important ，也支持自定义类型。    |
    | 延迟时间    | 指定功能点满足告警条件后，若在此时间段内始终未恢复正常，系统才会向用户发出告警。可用于避免因短暂波动导致的误报。 |
    | 正常延迟时间 | 功能点脱离告警状态后，需在设定延迟时间内未再次发生异常，才会判定为已恢复正常并向用户提示，以避免异常短暂波动频繁提醒。 |
    | 偏离正常文本 | 触发告警时显示给用户的提示内容。                               |
    | 恢复正常文本 | 恢复正常后显示给用户的提示内容。                               |

    下图直观展示了延迟时间、正常延迟时间、用户确认告警，以及告警规则启用后的整体时间轴：

    <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/alarm-status.png" alt="告警状态时间轴" />

    当功能点为数值型时，还有以下参数：

    | 参数         | 说明                                                         |
    |------------|------------------------------------------------------------|
    | 限制启用     | 选择启用下限，上限或都启用。         |
    | 下限     | 规定正常数值的下限。当设备读数突破下限时，告警状态变为异常（LOW_LIMIT）。         |
    | 上限     | 规定正常数值的上限。当设备读数突破上限时，告警状态变为异常（HIGH_LIMIT）。         |
    | 死区     | 用于防止设备数据在阈值附近因轻微波动而导致状态频繁切换。<ul><li>启用下限时：当读数到达下限进入异常状态，仅当读数回升至 下限 + 死区 以上，状态才恢复为正常。</li><li>启用上限时：当读数到达上限进入异常状态，仅当读数下降至 上限 − 死区 以下，状态才恢复为正常。</li></ul> |

    下图展示了设备读数分别突破下限、上限，以及回到下限+死区、上限-死区等关键点时，告警状态随数值变化的响应过程。
    
    <img src="https://itad-aqara-docs-1300889962.aqara.com/dev/img/aqara-studio/zh/states-for-numeric-points.jpg" alt="设备读数与告警状态" />

    完成配置后，单击确认，可以看到**告警配置**区域多了一个卡片。
5. 单击卡片上的 toggle 按钮，即可启用该告警配置。
6. 告警配置启用后，一旦设备功能点数值达到设定的告警条件，告警配置卡片将自动展示告警提示、状态、发生时间及确认按钮。您可点击确认按钮，快速知晓该告警。
    :::tip
    您也可以前往 [告警中心](./../alarm-management.mdx) 查看告警的详细信息，如告警数据、恢复正常时间、告警确认时间等。 
    :::

## 告警生命周期

在功能点配置页面的 **告警配置** 区域，您可以通过告警配置卡片实时查看当前告警的状态，直观了解其所处的生命周期阶段。

告警的生命周期可分为“告警中-待确认”“告警中-已确认”“告警恢复-待确认”和“告警关闭”四个阶段。告警的流转既与告警本身是否已恢复正常有关，也与用户是否确认相关。整体流程如下图所示：

```mermaid
flowchart TD
    style A fill:#f8d7da,stroke:#c62828,color:#000,font-weight:bold
    style B fill:#f8d7da,stroke:#c62828,color:#000,font-weight:bold
    style C fill:#fff3cd,stroke:#f57c00,color:#000
    style D fill:#ffffff,stroke:#616161,color:#000

    A[<b>告警中<br/>待确认</b>]
    B[<b>告警中<br/>已确认</b>]
    C[<b>告警恢复<br/>待确认</b>]
    D[<b>告警关闭</b>]

    %% 改善箭头位置和含义
    A -- 点击“确认告警” --> B
    A -- 告警恢复 --> C
    B -- 告警恢复 --> D
    C -- 点击“确认告警” --> D

    %% 增加说明标签
    A:::red
    B:::red
    C:::orange
    D:::whitebg

    classDef red fill:#f8d7da,stroke:#c62828,color:#000,font-weight:bold
    classDef orange fill:#fff3cd,stroke:#f57c00,color:#000
    classDef whitebg fill:#ffffff,stroke:#616161,color:#000
```

各阶段说明：

- **告警中-待确认**：产生新告警，且用户还未确认，表示需要关注和处理此告警。
- **告警中-已确认**：告警仍存在，但用户已知晓，表示正在处理此告警。
- **告警恢复-待确认**：告警已恢复正常，但用户还未确认，表示告警事件需用户确认后才能关闭。
- **告警关闭**：告警已恢复正常，且用户已确认，该告警事件关闭。

## 常见问题

### 为什么在 Aqara Studio 中告警被确认后，系统仍会继续提示告警？

由于设备功能点的数值未发生变化，依然处于符合告警条件的状态，因此即使您手动确认了告警，Aqara Studio 仍会持续发出告警提示。只有当该功能点的数值恢复至正常后，系统才会自动终止告警提示。